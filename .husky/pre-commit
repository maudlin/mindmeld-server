set -e

# Run staged file linters/formatters first for quick feedback
printf "\n[husky] Running lint-staged...\n"
npx --no -- lint-staged

# Mirror CI checks
printf "\n[husky] Lint...\n"
npm run lint

printf "\n[husky] Format check...\n"
npm run format:check

printf "\n[husky] OpenAPI lint...\n"
npm run openapi:lint

printf "\n[husky] Tests (CI mode)...\n"
npm test -- --ci --reporters=default

# Quick architecture health check
printf "\n[husky] Architecture health check...\n"
if command -v bash >/dev/null 2>&1; then
    bash scripts/pre-commit-health.sh || echo "Health check completed with warnings"
else
    echo "Bash not available - skipping health check"
fi
